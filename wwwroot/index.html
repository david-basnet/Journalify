<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>MauiApp1</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="MauiApp1.styles.css" />
    <link rel="icon" href="data:,">
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui" style="display: none;">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script>
        // Enhanced theme helper with icon updates
        (function(){
            function applyTheme(theme){
                if(theme === 'dark') {
                    document.documentElement.classList.add('theme-dark');
                } else {
                    document.documentElement.classList.remove('theme-dark');
                }
                updateThemeIcon(theme);
            }

            function updateThemeIcon(theme) {
                var icon = document.getElementById('theme-icon');
                var text = document.getElementById('theme-text');
                if (icon) {
                    icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                }
                if (text) {
                    text.textContent = theme === 'dark' ? 'Light Mode' : 'Dark Mode';
                }
            }

            var saved = localStorage.getItem('appTheme') || 'light';
            applyTheme(saved);

            window.toggleTheme = function(){
                var current = localStorage.getItem('appTheme') || 'light';
                var next = current === 'dark' ? 'light' : 'dark';
                localStorage.setItem('appTheme', next);
                applyTheme(next);
                // Trigger Blazor state update
                if (window.Blazor) {
                    setTimeout(function() {
                        DotNet.invokeMethodAsync('MauiApp1', 'UpdateTheme');
                    }, 0);
                }
            }

            window.getTheme = function(){
                return localStorage.getItem('appTheme') || 'light';
            }

            // Update icon on page load
            document.addEventListener('DOMContentLoaded', function() {
                updateThemeIcon(saved);
            });
        })();
    </script>
    <script>
        // Small editor utilities used by NewEntry for inserting markdown snippets
        window.editor = {
            insertAtCursor: function(textareaId, before, after) {
                var ta = document.getElementById(textareaId);
                if (!ta) return;
                var start = ta.selectionStart;
                var end = ta.selectionEnd;
                var selected = ta.value.substring(start, end);
                var newText = before + selected + after;
                ta.setRangeText(newText, start, end, 'end');
                ta.focus();
                // dispatch input event so Blazor sees the change
                ta.dispatchEvent(new Event('input', { bubbles: true }));
            },
            insertLink: function(textareaId) {
                var ta = document.getElementById(textareaId);
                if (!ta) return;
                var start = ta.selectionStart;
                var end = ta.selectionEnd;
                var selected = ta.value.substring(start, end) || 'link text';
                var url = prompt('Enter URL', 'https://');
                if (!url) return;
                var newText = '[' + selected + '](' + url + ')';
                ta.setRangeText(newText, start, end, 'end');
                ta.focus();
                ta.dispatchEvent(new Event('input', { bubbles: true }));
            }
        };
    </script>

</body>

</html>